<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TURFMAPP - Admin</title>
    <meta name="description" content="Admin configuration">
    <link rel="stylesheet" href="styles/home.css">
    <link rel="stylesheet" href="styles/sphere.css">
    <style>
        html, body { 
            min-height: 100vh; 
            overflow-x: hidden;
            overflow-y: auto;
        }
        body {
            margin: 0;
            font-family: 'DANSON', sans-serif;
            position: relative;
            background: url('AdminBackground.jpg') center center/cover no-repeat fixed;
        }

        /* Override shared app-background to use Admin page image */
        .app-background {
            background: url('AdminBackground.jpg') center center/cover no-repeat;
            background-attachment: scroll;
        }

        /* Pull main content and section closer to header */
        .main-content { padding: var(--spacing-lg) 0 var(--spacing-xl); }
        .profile-section { margin-top: var(--spacing-md); }
        
        
        .announcement-display {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .announcement-label {
            color: #ffffff;
            font-size: 0.85rem;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .announcement-text {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            font-weight: 500;
            max-width: 300px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .admin-note { color: var(--color-secondary); font-size: 0.95rem; }
        .form-row { display: grid; grid-template-columns: 200px 1fr; gap: 10px 16px; align-items: center; }
        .form-row .label { color: var(--color-tertiary); }
        .text-input {
            width: 100%;
            background: rgba(0,0,0,0.35);
            color: var(--color-primary);
            border: 1px solid var(--color-border);
            border-radius: 10px;
            padding: 10px 12px;
            outline: none;
        }
        .save-btn {
            background: rgba(255,255,255,0.14);
            color: var(--color-primary);
            border: 1px solid var(--color-border);
            border-radius: 10px;
            padding: 10px 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .save-btn:hover {
            background: rgba(255,255,255,0.22);
            border-color: var(--color-border-hover);
            transform: translateY(-1px);
        }
        
        /* Tool Checkboxes */
        .tool-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            color: var(--color-primary);
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        .tool-checkbox:hover {
            color: var(--color-border-hover);
        }
        .tool-checkbox input[type="checkbox"] {
            width: 16px;
            height: 16px;
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--color-border);
            border-radius: 4px;
            cursor: pointer;
            appearance: none;
            -webkit-appearance: none;
            position: relative;
            transition: all 0.3s ease;
        }
        .tool-checkbox input[type="checkbox"]:checked {
            background: rgba(255,255,255,0.2);
            border-color: var(--color-border-hover);
        }
        .tool-checkbox input[type="checkbox"]:checked::after {
            content: "âœ“";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--color-primary);
            font-size: 12px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- Sphere background -->
    <div class="app-background">
        <div class="sphere" aria-hidden="true">
            <i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i>
            <i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i>
            <i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i>
            <i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i>
        </div>
    </div>
    
    <header class="app-header" role="banner">
        <div class="header-container">
            <div class="brand-section">
                <button id="left-panel-toggle" class="left-toggle-btn" aria-label="Open sidebar" aria-expanded="false" aria-controls="left-panel">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
                <h1 class="app-title">TURFMAPP</h1>
            </div>
            
            <div class="top-actions">
                <div class="announcement-display" id="announcement-display" style="display: none;">
                    <span class="announcement-label">Announcement:</span>
                    <span class="announcement-text" id="announcement-text-display"></span>
                </div>
            </div>
        </div>
    </header>

    <main class="main-content" role="main">
        <div class="content-container">
            <section class="profile-section" aria-labelledby="admin-title">
                <div class="profile-card">
                    <div class="profile-header">
                        <div class="profile-avatar-lg" aria-hidden="true"></div>
                        <div>
                            <h2 id="admin-title" class="profile-title">Administration</h2>
                            <p class="admin-note">Manage roles and configuration (placeholders).</p>
                        </div>
                    </div>

                    <div class="profile-grid" style="row-gap: 18px;">
                        <div class="form-row">
                            <div class="label">Announcement</div>
                            <div class="admin-note">Set announcement text that appears on all pages</div>
                        </div>
                        
                        <div class="form-row" style="align-items: start;">
                            <div class="label">Message</div>
                            <div style="display: flex; flex-direction: column; gap: 8px; flex: 1;">
                                <textarea id="announcement-text" class="textarea-input" placeholder="Enter announcement message..." rows="2"></textarea>
                                <div style="display: flex; gap: 8px;">
                                    <button type="button" id="save-announcement" class="save-btn">Save Announcement</button>
                                    <button type="button" id="clear-announcement" class="save-btn" style="background: rgba(255,100,100,0.14);">Clear</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="label">LLM Configuration</div>
                            <div class="admin-note">Configure OpenAI Responses API settings for chat functionality</div>
                        </div>
                        
                        <div class="form-row">
                            <div class="label">API Settings</div>
                            <div class="admin-note">OpenAI API key is loaded from .env (OPENAI_API_KEY). No key entry here.</div>
                        </div>
                        
                        <div class="form-row">
                            <div class="label">Model</div>
                            <select id="chat-model" class="select-input">
                                <option value="gpt-5-mini">gpt-5-mini (Latest, Fast)</option>
                                <option value="gpt-4o-mini">gpt-4o-mini (Fast, Cost-effective)</option>
                                <option value="gpt-4o">gpt-4o (Balanced)</option>
                                <option value="gpt-4-turbo">gpt-4-turbo (Advanced)</option>
                                <option value="gpt-4">gpt-4 (Legacy)</option>
                                <option value="gpt-3.5-turbo">gpt-3.5-turbo (Basic)</option>
                            </select>
                        </div>
                        
                        <div class="form-row" style="align-items: start;">
                            <div class="label">Developer Instructions</div>
                            <textarea id="developer-instructions" class="textarea-input" placeholder="(leave blank)"></textarea>
                            <div class="admin-note" style="grid-column: 2; margin-top: 4px;">Developer role instructions (input_text)</div>
                        </div>
                        
                        <div class="form-row" style="align-items: start;">
                            <div class="label">Assistant Context</div>
                            <textarea id="assistant-context" class="textarea-input" placeholder="(leave blank)"></textarea>
                            <div class="admin-note" style="grid-column: 2; margin-top: 4px;">Assistant role context (output_text)</div>
                        </div>
                        
                        <div class="form-row">
                            <div class="label">Text Format</div>
                            <select id="text-format" class="select-input">
                                <option value="text">Text</option>
                                <option value="markdown">Markdown</option>
                                <option value="json">JSON</option>
                            </select>
                            <div class="admin-note" style="grid-column: 2; margin-top: 4px;">Response format type</div>
                        </div>
                        
                        <div class="form-row">
                            <div class="label">Text Verbosity</div>
                            <select id="text-verbosity" class="select-input">
                                <option value="low">Low</option>
                                <option value="medium">Medium</option>
                                <option value="high">High</option>
                            </select>
                            <div class="admin-note" style="grid-column: 2; margin-top: 4px;">Response detail level</div>
                        </div>
                        
                        <div class="form-row">
                            <div class="label">Reasoning Effort</div>
                            <select id="reasoning-effort" class="select-input">
                                <option value="low">Low</option>
                                <option value="medium">Medium</option>
                                <option value="high">High</option>
                            </select>
                            <div class="admin-note" style="grid-column: 2; margin-top: 4px;">AI reasoning complexity</div>
                        </div>
                        
                        <div class="form-row">
                            <div class="label">Reasoning Summary</div>
                            <select id="reasoning-summary" class="select-input">
                                <option value="auto">Auto</option>
                                <option value="always">Always</option>
                                <option value="never">Never</option>
                            </select>
                            <div class="admin-note" style="grid-column: 2; margin-top: 4px;">When to provide reasoning summary</div>
                        </div>
                        
                        <div class="form-row" style="align-items: start;">
                            <div class="label">Tools Configuration</div>
                            <div style="display: flex; flex-direction: column; gap: 12px;">
                                <div class="tool-section">
                                    <label class="tool-checkbox">
                                        <input type="checkbox" id="tool-web-search" checked>
                                        <span>Web Search Preview</span>
                                    </label>
                                    <div class="tool-config" style="margin-left: 24px; margin-top: 4px;">
                                        <label style="font-size: 0.8rem; color: var(--color-tertiary);">
                                            Search Context:
                                            <select id="web-search-context" class="select-input" style="font-size: 0.8rem; margin-left: 8px;">
                                                <option value="small">Small</option>
                                                <option value="medium">Medium</option>
                                                <option value="large">Large</option>
                                            </select>
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="tool-section">
                                    <label class="tool-checkbox">
                                        <input type="checkbox" id="tool-image-generation">
                                        <span>Image Generation</span>
                                    </label>
                                    <div class="tool-config" style="margin-left: 24px; margin-top: 4px;">
                                        <label style="font-size: 0.8rem; color: var(--color-tertiary);">
                                            Quality:
                                            <select id="image-quality" class="select-input" style="font-size: 0.8rem; margin-left: 8px;">
                                                <option value="auto">Auto</option>
                                                <option value="standard">Standard</option>
                                                <option value="hd">HD</option>
                                            </select>
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="tool-section">
                                    <label class="tool-checkbox">
                                        <input type="checkbox" id="tool-mcp">
                                        <span>MCP Integration</span>
                                    </label>
                                    <div class="tool-config" style="margin-left: 24px; margin-top: 4px;">
                                        <input type="text" id="mcp-server-label" class="text-input" placeholder="Server Label (e.g., googledrive)" style="font-size: 0.8rem; margin-bottom: 4px;">
                                        <input type="text" id="mcp-connector-id" class="text-input" placeholder="Connector ID" style="font-size: 0.8rem;">
                                    </div>
                                </div>
                            </div>
                            <div class="admin-note" style="grid-column: 2; margin-top: 4px;">Configure available tools and their settings</div>
                        </div>
                        
                        <div class="form-row">
                            <div class="label">Store Responses</div>
                            <label class="tool-checkbox">
                                <input type="checkbox" id="store-responses" checked>
                                <span>Enable</span>
                            </label>
                            <div class="admin-note" style="grid-column: 2; margin-top: 4px;">Store responses for training and improvement</div>
                        </div>
                    </div>

                    <div class="profile-actions">
                        <button class="save-btn" id="save-chat-settings" title="Save Responses API settings to this browser">Save LLM Settings</button>
                        <button class="outline-action-btn" id="reset-form" title="Reset all settings to defaults">Reset to Defaults</button>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <script src="scripts/config.js"></script>
    <script src="scripts/utils.js"></script>
    <script src="scripts/supabase-client.js"></script>
    <script src="scripts/google-auth.js"></script>
    <script src="scripts/chat.js"></script>
    <script>
        // Load existing local settings
        (function(){
            try {
                // Load basic settings
                var model = localStorage.getItem('tm_model');
                var devInstructions = '';
                var assistantContext = '';
                
                // Load text and reasoning settings
                var textFormat = localStorage.getItem('tm_text_format') || 'text';
                var textVerbosity = localStorage.getItem('tm_text_verbosity') || 'medium';
                var reasoningEffort = localStorage.getItem('tm_reasoning_effort') || 'medium';
                var reasoningSummary = localStorage.getItem('tm_reasoning_summary') || 'auto';
                
                // Load tool settings
                var toolWebSearch = localStorage.getItem('tm_tool_web_search') || 'true';
                var webSearchContext = localStorage.getItem('tm_web_search_context') || 'medium';
                var toolImageGen = localStorage.getItem('tm_tool_image_generation') || 'false';
                var imageQuality = localStorage.getItem('tm_image_quality') || 'auto';
                var toolMcp = localStorage.getItem('tm_tool_mcp') || 'false';
                var mcpServerLabel = localStorage.getItem('tm_mcp_server_label') || '';
                var mcpConnectorId = localStorage.getItem('tm_mcp_connector_id') || '';
                var storeResponses = localStorage.getItem('tm_store_responses') || 'true';
                var announcement = localStorage.getItem('announcement') || '';
                
                // Set basic settings
                if (document.getElementById('announcement-text')) {
                    document.getElementById('announcement-text').value = announcement;
                }
                if (model && document.getElementById('chat-model')) {
                    document.getElementById('chat-model').value = model;
                }
                if (document.getElementById('developer-instructions')) {
                    document.getElementById('developer-instructions').value = '';
                }
                if (document.getElementById('assistant-context')) {
                    document.getElementById('assistant-context').value = '';
                }
                
                // Set text and reasoning settings
                if (document.getElementById('text-format')) {
                    document.getElementById('text-format').value = textFormat;
                }
                if (document.getElementById('text-verbosity')) {
                    document.getElementById('text-verbosity').value = textVerbosity;
                }
                if (document.getElementById('reasoning-effort')) {
                    document.getElementById('reasoning-effort').value = reasoningEffort;
                }
                if (document.getElementById('reasoning-summary')) {
                    document.getElementById('reasoning-summary').value = reasoningSummary;
                }
                
                // Set tool settings
                if (document.getElementById('tool-web-search')) {
                    document.getElementById('tool-web-search').checked = toolWebSearch === 'true';
                }
                if (document.getElementById('web-search-context')) {
                    document.getElementById('web-search-context').value = webSearchContext;
                }
                if (document.getElementById('tool-image-generation')) {
                    document.getElementById('tool-image-generation').checked = toolImageGen === 'true';
                }
                if (document.getElementById('image-quality')) {
                    document.getElementById('image-quality').value = imageQuality;
                }
                if (document.getElementById('tool-mcp')) {
                    document.getElementById('tool-mcp').checked = toolMcp === 'true';
                }
                if (document.getElementById('mcp-server-label')) {
                    document.getElementById('mcp-server-label').value = mcpServerLabel;
                }
                if (document.getElementById('mcp-connector-id')) {
                    document.getElementById('mcp-connector-id').value = mcpConnectorId;
                }
                if (document.getElementById('store-responses')) {
                    document.getElementById('store-responses').checked = storeResponses === 'true';
                }
                
            } catch (e) {
                console.error('Error loading settings:', e);
            }
        })();

        // Save all Responses API settings to localStorage (browser)
        document.getElementById('save-chat-settings')?.addEventListener('click', function () {
            try {
                // Get basic settings
                var model = document.getElementById('chat-model')?.value || '';
                var devInstructions = '';
                var assistantContext = '';
                
                // Get text and reasoning settings
                var textFormat = document.getElementById('text-format')?.value || 'text';
                var textVerbosity = document.getElementById('text-verbosity')?.value || 'medium';
                var reasoningEffort = document.getElementById('reasoning-effort')?.value || 'medium';
                var reasoningSummary = document.getElementById('reasoning-summary')?.value || 'auto';
                
                // Get tool settings
                var toolWebSearch = document.getElementById('tool-web-search')?.checked || false;
                var webSearchContext = document.getElementById('web-search-context')?.value || 'medium';
                var toolImageGen = document.getElementById('tool-image-generation')?.checked || false;
                var imageQuality = document.getElementById('image-quality')?.value || 'auto';
                var toolMcp = document.getElementById('tool-mcp')?.checked || false;
                var mcpServerLabel = document.getElementById('mcp-server-label')?.value || '';
                var mcpConnectorId = document.getElementById('mcp-connector-id')?.value || '';
                var storeResponses = document.getElementById('store-responses')?.checked || false;
                
                // Save all settings
                if (model) localStorage.setItem('tm_model', model);
                // Always clear stored dev/assistant context
                localStorage.removeItem('tm_developer_instructions');
                localStorage.removeItem('tm_assistant_context');
                
                localStorage.setItem('tm_text_format', textFormat);
                localStorage.setItem('tm_text_verbosity', textVerbosity);
                localStorage.setItem('tm_reasoning_effort', reasoningEffort);
                localStorage.setItem('tm_reasoning_summary', reasoningSummary);
                
                localStorage.setItem('tm_tool_web_search', toolWebSearch.toString());
                localStorage.setItem('tm_web_search_context', webSearchContext);
                localStorage.setItem('tm_tool_image_generation', toolImageGen.toString());
                localStorage.setItem('tm_image_quality', imageQuality);
                localStorage.setItem('tm_tool_mcp', toolMcp.toString());
                localStorage.setItem('tm_mcp_server_label', mcpServerLabel);
                localStorage.setItem('tm_mcp_connector_id', mcpConnectorId);
                localStorage.setItem('tm_store_responses', storeResponses.toString());
                
                alert('Responses API settings saved locally.');
            } catch (e) {
                alert('Unable to save settings: ' + (e && e.message ? e.message : 'unknown error'));
            }
        });

        // Reset form to defaults
        document.getElementById('reset-form')?.addEventListener('click', function () {
            if (confirm('Are you sure you want to reset all settings to defaults? This will clear all saved configurations.')) {
                // Clear localStorage
                const keys = Object.keys(localStorage).filter(key => key.startsWith('tm_'));
                keys.forEach(key => localStorage.removeItem(key));
                
                // Reset form values to defaults
                if (document.getElementById('chat-model')) document.getElementById('chat-model').value = 'gpt-5-mini';
                if (document.getElementById('developer-instructions')) {
                    document.getElementById('developer-instructions').value = '';
                }
                if (document.getElementById('assistant-context')) {
                    document.getElementById('assistant-context').value = '';
                }
                if (document.getElementById('text-format')) document.getElementById('text-format').value = 'text';
                if (document.getElementById('text-verbosity')) document.getElementById('text-verbosity').value = 'medium';
                if (document.getElementById('reasoning-effort')) document.getElementById('reasoning-effort').value = 'medium';
                if (document.getElementById('reasoning-summary')) document.getElementById('reasoning-summary').value = 'auto';
                if (document.getElementById('tool-web-search')) document.getElementById('tool-web-search').checked = true;
                if (document.getElementById('web-search-context')) document.getElementById('web-search-context').value = 'medium';
                if (document.getElementById('tool-image-generation')) document.getElementById('tool-image-generation').checked = false;
                if (document.getElementById('image-quality')) document.getElementById('image-quality').value = 'auto';
                if (document.getElementById('tool-mcp')) document.getElementById('tool-mcp').checked = false;
                if (document.getElementById('mcp-server-label')) document.getElementById('mcp-server-label').value = '';
                if (document.getElementById('mcp-connector-id')) document.getElementById('mcp-connector-id').value = '';
                if (document.getElementById('store-responses')) document.getElementById('store-responses').checked = true;
                
                alert('All settings have been reset to defaults.');
            }
        });
    </script>
    
    <!-- Left sidebar panel -->
    <aside id="left-panel" class="left-panel" aria-hidden="true">
        <div class="left-panel-inner">
            <div class="left-panel-header">
                <button id="btn-new-chat" class="new-chat-btn" type="button" onclick="window.location.href='home.html'">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 5v14m7-7H5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    New chat
                </button>
                <button id="left-panel-close" class="close-panel-btn" aria-label="Close sidebar">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
            
            <div class="left-panel-content">
                <!-- Bottom Menu Section -->
                <div class="panel-bottom-menu">
                    <a href="home.html" class="menu-item">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>Home</span>
                    </a>
                    <a href="profile.html" class="menu-item profile-item">
                        <span class="profile-thumb" aria-hidden="true"></span>
                        <span>Profile</span>
                    </a>
                    <a href="admin.html" class="menu-item">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 15a3 3 0 100-6 3 3 0 000 6z" stroke="currentColor" stroke-width="2"/>
                            <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <span>Admin</span>
                    </a>
                    <button class="menu-item danger logout-btn" onclick="GoogleAuth.signOut()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4m7 14l5-5-5-5m5 5H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>Logout</span>
                    </button>
                </div>
            </div>
        </div>
    </aside>

    <script>
        // Initialize left panel toggle functionality
        document.addEventListener('DOMContentLoaded', function() {
            const toggleBtn = document.getElementById('left-panel-toggle');
            const closeBtn = document.getElementById('left-panel-close');
            const panel = document.getElementById('left-panel');
            
            if (toggleBtn && panel) {
                toggleBtn.addEventListener('click', function() {
                    panel.classList.toggle('open');
                    toggleBtn.setAttribute('aria-expanded', panel.classList.contains('open'));
                    panel.setAttribute('aria-hidden', !panel.classList.contains('open'));
                    document.body.classList.toggle('panel-open', panel.classList.contains('open'));
                });
            }
            
            if (closeBtn && panel) {
                closeBtn.addEventListener('click', function() {
                    panel.classList.remove('open');
                    toggleBtn.setAttribute('aria-expanded', 'false');
                    panel.setAttribute('aria-hidden', 'true');
                    document.body.classList.remove('panel-open');
                });
            }
            
            // Announcement functionality
            const saveAnnouncementBtn = document.getElementById('save-announcement');
            const clearAnnouncementBtn = document.getElementById('clear-announcement');
            const announcementTextarea = document.getElementById('announcement-text');
            
            if (saveAnnouncementBtn && announcementTextarea) {
                saveAnnouncementBtn.addEventListener('click', function() {
                    const announcementText = announcementTextarea.value.trim();
                    localStorage.setItem('announcement', announcementText);
                    
                    // Trigger storage event for other pages to update
                    window.dispatchEvent(new StorageEvent('storage', {
                        key: 'announcement',
                        newValue: announcementText
                    }));
                    
                    alert('Announcement saved successfully!');
                });
            }
            
            if (clearAnnouncementBtn && announcementTextarea) {
                clearAnnouncementBtn.addEventListener('click', function() {
                    announcementTextarea.value = '';
                    localStorage.removeItem('announcement');
                    
                    // Trigger storage event for other pages to update
                    window.dispatchEvent(new StorageEvent('storage', {
                        key: 'announcement',
                        newValue: ''
                    }));
                    
                    alert('Announcement cleared successfully!');
                });
            }
            
            // Load and display announcement in header
            function loadAnnouncementDisplay() {
                const announcement = localStorage.getItem('announcement');
                const announcementDisplay = document.getElementById('announcement-display');
                const announcementTextDisplay = document.getElementById('announcement-text-display');
                
                if (announcement && announcement.trim() !== '') {
                    announcementTextDisplay.textContent = announcement;
                    announcementDisplay.style.display = 'flex';
                } else {
                    announcementDisplay.style.display = 'none';
                }
            }
            
            // Load announcement display when page loads
            loadAnnouncementDisplay();
            
            // Listen for storage changes (when announcement is updated from this page)
            window.addEventListener('storage', function(e) {
                if (e.key === 'announcement') {
                    loadAnnouncementDisplay();
                }
            });
            
        });
    </script>
</body>
</html>
